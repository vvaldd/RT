SELECT * FROM `dec-2020`.students;
-- поиск WHERE
select * from students where age = 20;
select name, age from students;
select * from students where name = 'roman'; 
select * from  students where name like '%n'; -- команда похожести - like
select * from students where name like 'o%';
select * from students where name like '%o%';
select * from students where name like '___a%';
select * from students where name like '___a';
-- сортировка order by
select * from students order by age;
select * from students order by age DESC;
select * from students order by name;
select * from students order by id;
select * from students order by gender;
-- 
select * from students where gender = 'male' order by age;
select * from students where length(name) = 4;
select * from students where age >= 18 order by age;
select * from students where age <= 15; 
select * from students where age != 18; --
select * from students where age <> 18;
-- поиск в заданых величинах
select * from students where age between 20 and 30; -- команда 'между' - between
select * from students where age >= 20 and age <=30;
select * from students where gender = 'female' and age > 20;
select * from students where age > 20 or gender like 'f%'; -- команда 'или' - or
select * from students where age = 18 or (name like 'o%' and gender like 'f%');
select * from students where age between 20 and 30 or name like 'o%' order by age;
select * from students where age in(20, 25, 30); -- команда по подбору в четких параметрах - in
select * from students where name in('ira','ivan','dima');
select max(age) from students; -- макс. возраст
select min(age) from students; -- мин. возраст
select avg(age) from students; -- средний возраст
select sum(age) from students; -- общий возраст
select count(age) from students where gender ='male'; -- подсчет количества полей по определенному признаку
select max(age), gender from students group by gender; -- сортировка по  групповому признаку - group by
select
	avg(rating) as avgRat, -- переименование
    count(rating) as countRat
from ratings
where student_id = 5;
select avg(rating), count(rating), student_id from ratings group by student_id;
-- пагинация
select * from students limit 3;
select * from students limit 3 offset 3;
select * from students limit 3 offset 6;

-- обновление
update students set name = 'Petya' where age < 15 limit 1000;
SELECT * FROM `dec-2020`.students;

-- удаление
delete from students where name = 'kolya' limit 1000;
SELECT * FROM `dec-2020`.students;

-- practice
SELECT * FROM students;
select * from students where gender = 'female';
select * from students where gender = 'male' and age between 20 and 30;
select * from students where gender = 'female' and name like '_a%a';
select avg(age) from students where gender = 'male';
select max(age), name from students where gender = 'female';
select * from students limit 3 offset 8;
select count(id) from students where gender = 'female';
select count(id) from students where gender = 'male';
SELECT * FROM students;
update students set gender = 'female' where name like 'a%' limit 1000;
update students set name = 'Antonina' where name = 'anton' limit 1000;
update students set age = '10' where not name like '%a' and gender = 'female' limit 1000;
delete from students where not age between 25 and 40 limit 1000;
delete from students where age >= 25 and age <=40 limit 1000;
delete from students where id in(11, 12);

lesson 2
insert into cars(model) value ('Aston Martin'); -- добавление данных в таблицу
insert into cars(model) value ('BMV');
insert into users(name,car_id) value ('Kolya', 5);
insert into users(name,car_id) value ('Oleg', 6);

select * from users join cars on users.car_id = cars.id; -- выборка по нескольким таблицам 
select -- выборка по нескольким таблицам с по заданным столбцам
	u.name as userName, --  переименование столбцов
	c.model as carsModel
from users u -- переименование таблиц в запросе
join cars c
on u.car_id = c.id;

select
	s.name,
    s.age,
    l.label,
    l.date
from ratings r
join students s on r.student_id = s.id
join lesson l on r.lesson_id = l.id
where rating = 5;

select
	count(r.rating) as ratingCount,
    s.name,
    s.id
from ratings r
join students s on r.student_id = s.id
where r.rating = 5
group by r.student_id;

select concat(name, '--', age) as fullName, gender from students; -- объеденение информации из нескольких ячеек в одну

select distinct(gender) from students; -- выборка по уникальным именам

select * from students where id in (select student_id from ratings where rating = 5);

select * from users u right join cars c on u.car_id = c.id; -- левый и правый джоины отображают полную таблицу слева или справа от join


hw
SELECT * FROM client where length(firstname) < 6;
select * from department where DepartmentCity = 'lviv';
select * from client where Education = 'high' order by LastName;
select * from application order by idApplication desc limit 5 offset 10;
select * from client where lastname like '%ov' or lastname like '%ova'; -- select * from client where lastname like '%ych' or lastname like '%iv';
select * from client where Department_idDepartment in(select idDepartment from department where DepartmentCity = 'kyiv');
select firstname, lastname, number from client group by FirstName; -- select firstname, lastname, passport from client group by FirstName; 
select * -- 8
from client c
join application a on c.idClient = a.Client_idClient
where sum > 5000;

select -- 9
	count(idclient) as countLviv
from client c
join department d on c.Department_idDepartment = d.idDepartment
where DepartmentCity = 'lviv';

select -- 9
	count(idclient) as countAll
from client c
join department d on c.Department_idDepartment = d.idDepartment;

select -- 10
	max(sum) as maxSum,
    c.LastName
from application a
join client c on a.Client_idClient = c.idClient
group by idClient;

select -- 11
	count(idApplication) as countApl,
    c.lastname
from application a
join client c on a.Client_idClient= c.idClient
group by idClient;

select max(sum), min(sum) from application; -- 12

select -- 13
	count(idApplication) as countApl,
    c.lastname,
    c.age
from application a
join client c on a.Client_idClient= c.idClient
where Education = 'high'
group by idClient;

select -- 14
	avg(sum)
from application a
join client c on a.Client_idClient= c.idClient
group by idClient order by avg(sum) desc limit 1;

select -- 15
	sum(sum),
    DepartmentCity,
    CountOfWorkers
from department d
join client c on d.idDepartment = c.Department_idDepartment
join application a on c.idClient = a.Client_idClient
group by d.idDepartment order by max(sum) desc limit 1;

select -- 16
	max(sum),
    DepartmentCity,
    CountOfWorkers
from department d
join client c on d.idDepartment = c.Department_idDepartment
join application a on c.idClient = a.Client_idClient
group by d.idDepartment order by max(sum) desc limit 1;

update application --  17
join client on application.Client_idClient = client.idclient
set Sum = 6000
where application.CreditState = 'Not returned' and client.Education = 'high';

update client c -- 18
join department d on c.Department_idDepartment = d.idDepartment
set city = 'Kyiv'
where d.DepartmentCity = 'Kyiv';

delete from application -- 19
where CreditState = 'Returned' limit 1000;

SET SQL_SAFE_UPDATES = 0;

delete application -- 20
from application
join client c on application.Client_idClient = c.idclient
where substr(c.lastname, 2, 1) in('e','u','i','o','a');-- where c.LastName like '_[aeiou]%'; не работает

select sum(sum), d.DepartmentCity, idDepartment -- 21
from application a
join client c on a.Client_idClient=c.idClient
join department d on c.Department_idDepartment = d.idDepartment
where d.DepartmentCity = 'lviv'
group by idDepartment having sum(sum) > 5000;

select -- 22
	c.lastname,
    a.sum
from client c
join department d on c.Department_idDepartment = d.idDepartment
join application a on c.idClient = a.Client_idClient
where a.CreditState = 'returned' and a.sum > 5000;

select --  23
	max(sum)
from application
where CreditState = 'not returned';

select -- 24
	min(sum),
    c.lastname,
    c.firstname
from client c
join department d on c.Department_idDepartment = d.idDepartment
join application a on c.idClient = a.Client_idClient
group by c.idClient order by min(sum) limit 1;

select * -- 25
from application where sum >(select avg(sum) from application); 

select * from client where city = (select -- 26
	c.city
from application a
join client c on c.idClient = a.Client_idClient
group by a.Client_idClient order by count(idApplication) desc limit 1);

select -- 27
	c.city
from application a
join client c on c.idClient = a.Client_idClient
group by a.Client_idClient order by count(idApplication) desc limit 1;